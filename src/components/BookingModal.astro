---
---
<div id="booking-modal" class="fixed inset-0 z-[100] hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
  <div class="fixed inset-0 bg-dark/60 backdrop-blur-sm transition-opacity opacity-0" id="modal-backdrop"></div>

  <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
    <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
      <div class="relative transform overflow-hidden rounded-2xl bg-sand text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-lg opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95" id="modal-panel">

        <button id="close-modal" class="absolute right-4 top-4 text-dark/50 hover:text-dark transition p-2 z-10">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>

        <div class="px-6 py-8 md:px-8 md:py-10">
            <div id="form-state">
                <div class="text-center mb-6">
                    <h3 class="text-2xl font-serif font-bold text-ocean">Réserver votre vague</h3>
                    <p class="text-sm text-dark/70 mt-2">Dites-nous en plus sur votre projet de voyage.</p>
                </div>

                <form id="booking-form" class="space-y-4">
                    <div class="space-y-4">
                        <div>
                            <label for="name" class="block text-xs font-bold uppercase tracking-widest text-dark mb-1 ml-1">Nom complet</label>
                            <input type="text" id="name" required class="w-full bg-white border border-stone-200 rounded-lg px-4 py-3 focus:outline-none focus:border-terra focus:ring-1 focus:ring-terra transition placeholder-stone-400" placeholder="Ex: Sarah Martin" />
                        </div>
                        <div>
                            <label for="email" class="block text-xs font-bold uppercase tracking-widest text-dark mb-1 ml-1">Email</label>
                            <input type="email" id="email" required class="w-full bg-white border border-stone-200 rounded-lg px-4 py-3 focus:outline-none focus:border-terra focus:ring-1 focus:ring-terra transition placeholder-stone-400" placeholder="Ex: sarah@email.com" />
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="date" class="block text-xs font-bold uppercase tracking-widest text-dark mb-1 ml-1">Arrivée</label>
                            <input type="date" id="date" required class="w-full bg-white border border-stone-200 rounded-lg px-4 py-3 focus:outline-none focus:border-terra transition text-stone-600" />
                        </div>
                        <div>
                            <label for="guests" class="block text-xs font-bold uppercase tracking-widest text-dark mb-1 ml-1">Voyageurs</label>
                            <select id="guests" class="w-full bg-white border border-stone-200 rounded-lg px-4 py-3 focus:outline-none focus:border-terra transition text-stone-600">
                                <option>1 personne</option>
                                <option>2 personnes</option>
                                <option>3 personnes</option>
                                <option>4+ groupe</option>
                            </select>
                        </div>
                    </div>

                    <div>
                         <label for="interest" class="block text-xs font-bold uppercase tracking-widest text-dark mb-1 ml-1">Formule souhaitée</label>
                         <select id="interest" class="w-full bg-white border border-stone-200 rounded-lg px-4 py-3 focus:outline-none focus:border-terra transition text-stone-600">
                            <option value="general">Je ne sais pas encore / Autre</option>
                            <option value="surf">Cours de Surf</option>
                            <option value="trips">Surf Trip / Guiding</option>
                            <option value="sejours">Séjour Complet</option>
                  <option value="experiences">Expérience (Surf dune, camel ride...)</option>
                            <option value="housing">Hébergement seul</option>
                        </select>
                    </div>

                    <div>
                        <label for="message" class="block text-xs font-bold uppercase tracking-widest text-dark mb-1 ml-1">Message (Optionnel)</label>
                        <textarea id="message" rows="3" class="w-full bg-white border border-stone-200 rounded-lg px-4 py-3 focus:outline-none focus:border-terra focus:ring-1 focus:ring-terra transition placeholder-stone-400 resize-none" placeholder="Niveau de surf, questions..."></textarea>
                    </div>

                    <button type="submit" class="w-full bg-terra text-white font-bold py-4 rounded-xl shadow-lg hover:bg-terra/90 hover:-translate-y-0.5 transition-all duration-300 mt-2">
                        Envoyer la demande
                    </button>
                    <p class="text-[10px] text-center text-dark/40 uppercase tracking-wider">Aucun paiement requis pour l'instant</p>
                </form>
            </div>

            <div id="success-state" class="hidden text-center py-10">
                <div class="mx-auto flex h-20 w-20 items-center justify-center rounded-full bg-ocean/10 mb-6 animate-pulse">
                    <svg class="h-10 w-10 text-ocean" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                    </svg>
                </div>
                <h3 class="text-3xl font-serif font-bold text-ocean mb-4">Message reçu !</h3>
                <p class="text-dark/80 mb-8 max-w-xs mx-auto">Merci. Notre équipe va étudier votre demande et vous répondra sous 24h.</p>
                <button id="close-success" class="bg-dark text-white px-8 py-3 rounded-full font-bold uppercase tracking-widest text-xs shadow-lg hover:bg-dark/90 transition">
                    Retour au site
                </button>
            </div>

        </div>
      </div>
    </div>
  </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const modal = document.getElementById('booking-modal');
        const backdrop = document.getElementById('modal-backdrop');
        const panel = document.getElementById('modal-panel');
        const closeBtn = document.getElementById('close-modal');
        const closeSuccessBtn = document.getElementById('close-success');
        const form = document.getElementById('booking-form');
        const formState = document.getElementById('form-state');
        const successState = document.getElementById('success-state');
        const interestSelect = document.getElementById('interest') as HTMLSelectElement;

        window.openBookingModal = () => {
            if(!modal) return;
            modal.classList.remove('hidden');
            setTimeout(() => {
                backdrop.classList.remove('opacity-0');
                panel.classList.remove('opacity-0', 'translate-y-4', 'sm:translate-y-0', 'sm:scale-95');
                panel.classList.add('opacity-100', 'translate-y-0', 'sm:scale-100');
            }, 10);
            document.body.style.overflow = 'hidden';
        };

        const closeModal = () => {
            if(!modal) return;
            backdrop.classList.add('opacity-0');
            panel.classList.remove('opacity-100', 'translate-y-0', 'sm:scale-100');
            panel.classList.add('opacity-0', 'translate-y-4', 'sm:translate-y-0', 'sm:scale-95');

            setTimeout(() => {
                modal.classList.add('hidden');
                formState.classList.remove('hidden');
                successState.classList.add('hidden');
                form.reset();
            }, 300);
            document.body.style.overflow = 'auto';
        };

        closeBtn?.addEventListener('click', closeModal);
        closeSuccessBtn?.addEventListener('click', closeModal);

        modal?.addEventListener('click', (e) => {
            if (e.target === modal || e.target.closest('#modal-backdrop')) {
                closeModal();
            }
        });

        document.querySelectorAll('.js-open-booking').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();

                const formula = btn.getAttribute('data-formula');

                if (formula && interestSelect) {
                    interestSelect.value = formula;
                } else if (interestSelect) {
                    interestSelect.value = 'general';
                }

                window.openBookingModal();
            });
        });

        form?.addEventListener('submit', (e) => {
            e.preventDefault();
            const btn = form.querySelector('button[type="submit"]');
            const originalText = btn.innerText;
            btn.innerText = 'Envoi en cours...';
            btn.disabled = true;
            btn.classList.add('opacity-75', 'cursor-not-allowed');

            setTimeout(() => {
                formState.classList.add('hidden');
                successState.classList.remove('hidden');
                btn.innerText = originalText;
                btn.disabled = false;
                btn.classList.remove('opacity-75', 'cursor-not-allowed');
            }, 1000);
        });
    });
</script>
